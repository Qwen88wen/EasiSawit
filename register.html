<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Customer Registration - EasiSawit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  </head>
  <body class="bg-gradient-to-br from-emerald-50 to-blue-50">
    <div class="min-h-screen flex items-center justify-center px-4 py-8">
      <div class="w-full max-w-md bg-white rounded-lg shadow-lg p-8">
        <!-- Header -->
        <div class="text-center mb-8">
          <h1 class="text-3xl font-bold text-emerald-600 mb-2">EasiSawit</h1>
          <h2 class="text-xl font-semibold text-gray-800">
            Customer Registration
          </h2>
          <p class="text-gray-600 text-sm mt-2">Apply to become a customer</p>
        </div>

        <!-- Form -->
        <form id="registrationForm" class="space-y-4">
          <!-- Full Name -->
          <div>
            <label
              for="name"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Full Name *</label
            >
            <input
              type="text"
              id="name"
              name="name"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition"
              placeholder="Enter your full name"
            />
          </div>

          <!-- Email -->
          <div>
            <label
              for="email"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Email Address *</label
            >
            <input
              type="email"
              id="email"
              name="email"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition"
              placeholder="your@email.com"
            />
          </div>

          <!-- Contact Number -->
          <div>
            <label
              for="contact"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Contact Number *</label
            >
            <input
              type="tel"
              id="contact"
              name="contact"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition"
              placeholder="016-123-4567"
            />
          </div>

          <!-- Company Name -->
          <div>
            <label
              for="company_name"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Company Name</label
            >
            <input
              type="text"
              id="company_name"
              name="company_name"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition"
              placeholder="Your company name (optional)"
            />
          </div>

          <!-- Requested Rate -->
          <div>
            <label
              for="rate_requested"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Requested Rate (RM/ton)</label
            >
            <input
              type="number"
              id="rate_requested"
              name="rate_requested"
              step="0.01"
              min="0"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition"
              placeholder="e.g., 50.00"
            />
          </div>

          <!-- Message -->
          <div id="messageDiv" class="hidden p-3 rounded-lg text-sm"></div>

          <!-- Submit Button -->
          <button
            type="submit"
            id="submitBtn"
            class="w-full bg-emerald-600 text-white py-2 rounded-lg font-semibold hover:bg-emerald-700 transition flex items-center justify-center space-x-2"
          >
            <span>Submit Application</span>
            <i data-lucide="send" class="w-4 h-4"></i>
          </button>

          <!-- Back Link -->
          <div class="text-center">
            <a
              href="index.html"
              class="text-emerald-600 text-sm font-medium hover:underline"
              >‚Üê Back to Dashboard</a
            >
          </div>
        </form>

        <!-- Footer -->
        <div
          class="mt-8 pt-6 border-t border-gray-200 text-center text-xs text-gray-600"
        >
          <p>Your information will be reviewed by our admin team.</p>
          <p class="mt-2">Questions? Contact admin@easisawit.local</p>
        </div>
      </div>
    </div>

    <script>
      document
        .getElementById("registrationForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const submitBtn = document.getElementById("submitBtn");
          const messageDiv = document.getElementById("messageDiv");

          // Disable submit button
          submitBtn.disabled = true;
          submitBtn.innerHTML =
            '<i data-lucide="loader" class="w-4 h-4 animate-spin"></i> <span>Submitting...</span>';

          // Collect form data
          const formData = {
            name: document.getElementById("name").value.trim(),
            email: document.getElementById("email").value.trim(),
            contact: document.getElementById("contact").value.trim(),
            company_name:
              document.getElementById("company_name").value.trim() || null,
            rate_requested: document.getElementById("rate_requested").value
              ? parseFloat(document.getElementById("rate_requested").value)
              : null,
          };

          try {
            const response = await fetch("api/api_submit_application.php", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            });

            const result = await response.json();

            messageDiv.classList.remove("hidden");

            if (response.ok) {
              messageDiv.className =
                "p-3 rounded-lg text-sm bg-green-100 text-green-800 border border-green-300";
              messageDiv.innerHTML = `<strong>Success!</strong> ${result.message}<br/><small>Application ID: #${result.application_id}</small>`;

              // Reset form
              document.getElementById("registrationForm").reset();

              // Redirect after 3 seconds
              setTimeout(() => {
                window.location.href = "index.html";
              }, 3000);
            } else {
              messageDiv.className =
                "p-3 rounded-lg text-sm bg-red-100 text-red-800 border border-red-300";
              messageDiv.innerHTML = `<strong>Error:</strong> ${result.message}`;
            }
          } catch (error) {
            messageDiv.classList.remove("hidden");
            messageDiv.className =
              "p-3 rounded-lg text-sm bg-red-100 text-red-800 border border-red-300";
            messageDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
          } finally {
            // Re-enable submit button
            submitBtn.disabled = false;
            submitBtn.innerHTML =
              '<span>Submit Application</span><i data-lucide="send" class="w-4 h-4"></i>';
            lucide.createIcons();
          }
        });

      // Create icons on page load
      lucide.createIcons();
    </script>
  </body>
</html>
