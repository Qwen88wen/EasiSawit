<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Management Dashboard - EasiSawit</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="translations.js?v=5.0"></script>
  <script>
    // Access Control: Check if user is logged in
    // NOTE: This page is loaded in an iframe inside index.html,
    // which already verifies PHP session via check_auth.php.
    // We don't need to check sessionStorage here because:
    // 1. Parent window already authenticated the user
    // 2. sessionStorage can be cleared by parent window (e.g., during session expiry)
    // 3. Checking sessionStorage here causes false positives
    //
    // If this page is accessed directly (not in iframe), the API calls will fail
    // with 401 errors due to missing PHP session, which is the correct behavior.

    // Get current language from localStorage or default to 'en'
    let currentLang = localStorage.getItem('language') || 'en';
    let t = translations[currentLang].managementDashboard;

    // Listen for language changes from parent window (when in iframe)
    window.addEventListener('message', function(event) {
      if (event.data && event.data.type === 'languageChange') {
        currentLang = event.data.language;
        t = translations[currentLang].managementDashboard;
        applyAllTranslations();
      }
    });

    // Also listen to storage changes (for direct access)
    window.addEventListener('storage', function(e) {
      if (e.key === 'language') {
        currentLang = e.newValue || 'en';
        t = translations[currentLang].managementDashboard;
        applyAllTranslations();
      }
    });
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      background: #f5f7fa;
      background-image:
        radial-gradient(at 0% 0%, rgba(16, 185, 129, 0.1) 0px, transparent 50%),
        radial-gradient(at 100% 0%, rgba(59, 130, 246, 0.1) 0px, transparent 50%),
        radial-gradient(at 100% 100%, rgba(139, 92, 246, 0.1) 0px, transparent 50%),
        radial-gradient(at 0% 100%, rgba(236, 72, 153, 0.1) 0px, transparent 50%);
      min-height: 100vh;
      padding: 24px;
    }

    .glass-card {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
      transition: all 0.3s ease;
    }

    .glass-card:hover {
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .metric-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      border-left: 4px solid transparent;
    }

    .metric-card:hover {
      transform: translateY(-2px);
      border-left-color: currentColor;
    }

    .chart-container {
      position: relative;
      height: 300px;
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-slide-in {
      animation: slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .stat-number {
      font-size: 2.5rem;
      font-weight: 700;
      line-height: 1;
    }

    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
      border-radius: 8px;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Modern gradient header */
    .gradient-header {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.2);
    }

    /* Card accents */
    .card-accent-green { border-left-color: #10b981 !important; }
    .card-accent-blue { border-left-color: #3b82f6 !important; }
    .card-accent-purple { border-left-color: #8b5cf6 !important; }
    .card-accent-orange { border-left-color: #f59e0b !important; }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="gradient-header p-6 mb-6 animate-slide-in rounded-xl">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold text-white" data-i18n="title">Management Dashboard</h1>
        <p class="text-emerald-50" id="currentPeriod">Loading...</p>
      </div>
      <div class="flex gap-3">
        <select id="monthSelect" class="px-4 py-2 border border-emerald-300 rounded-lg bg-white/90 backdrop-blur focus:ring-2 focus:ring-white focus:outline-none">
          <!-- Populated by JS -->
        </select>
        <select id="yearSelect" class="px-4 py-2 border border-emerald-300 rounded-lg bg-white/90 backdrop-blur focus:ring-2 focus:ring-white focus:outline-none">
          <!-- Populated by JS -->
        </select>
        <button id="refreshButton" onclick="loadDashboardData()" class="bg-white text-emerald-600 px-6 py-2 rounded-lg hover:bg-emerald-50 transition flex items-center gap-2 font-semibold shadow-md">
          <i data-lucide="refresh-cw" style="width: 18px; height: 18px;"></i>
          <span data-i18n="refresh">Refresh</span>
        </button>
        <button id="backButton" onclick="window.location.href='index.html'" class="bg-emerald-700 text-white px-6 py-2 rounded-lg hover:bg-emerald-800 transition flex items-center gap-2 shadow-md">
          <i data-lucide="arrow-left" style="width: 18px; height: 18px;"></i>
          <span data-i18n="back">Back</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Key Metrics -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
    <!-- Total Production -->
    <div class="glass-card p-6 metric-card card-accent-green animate-slide-in" style="animation-delay: 0.1s">
      <div class="flex items-start justify-between">
        <div>
          <p class="text-gray-600 text-sm font-medium mb-2" data-i18n="totalProduction">Total Production</p>
          <p class="stat-number text-emerald-600" id="totalProduction">0</p>
          <p class="text-gray-500 text-sm mt-1" data-i18n="tons">tons</p>
        </div>
        <div class="p-3 bg-emerald-100 rounded-xl">
          <i data-lucide="trending-up" style="width: 24px; height: 24px; color: #059669;"></i>
        </div>
      </div>
    </div>

    <!-- Active Workers -->
    <div class="glass-card p-6 metric-card card-accent-blue animate-slide-in" style="animation-delay: 0.2s">
      <div class="flex items-start justify-between">
        <div>
          <p class="text-gray-600 text-sm font-medium mb-2" data-i18n="activeWorkers">Active Workers</p>
          <p class="stat-number text-blue-600" id="activeWorkers">0</p>
          <p class="text-gray-500 text-sm mt-1" data-i18n="employees">employees</p>
        </div>
        <div class="p-3 bg-blue-100 rounded-xl">
          <i data-lucide="users" style="width: 24px; height: 24px; color: #2563eb;"></i>
        </div>
      </div>
      <div class="mt-4 flex items-center gap-2" id="workerTypeBreakdown">
        <span class="text-xs text-gray-500"><span data-i18n="local">Local</span>: <span id="localWorkers" class="font-semibold text-blue-600">0</span></span>
        <span class="text-xs text-gray-400">|</span>
        <span class="text-xs text-gray-500"><span data-i18n="foreign">Foreign</span>: <span id="foreignWorkers" class="font-semibold text-blue-600">0</span></span>
      </div>
    </div>

    <!-- Total Revenue -->
    <div class="glass-card p-6 metric-card card-accent-purple animate-slide-in" style="animation-delay: 0.3s">
      <div class="flex items-start justify-between">
        <div>
          <p class="text-gray-600 text-sm font-medium mb-2" data-i18n="totalRevenue">Total Revenue</p>
          <p class="stat-number text-purple-600" id="totalRevenue">RM 0</p>
          <p class="text-gray-500 text-sm mt-1" data-i18n="grossIncome">gross income</p>
        </div>
        <div class="p-3 bg-purple-100 rounded-xl">
          <i data-lucide="dollar-sign" style="width: 24px; height: 24px; color: #9333ea;"></i>
        </div>
      </div>
    </div>

    <!-- Average Efficiency -->
    <div class="glass-card p-6 metric-card card-accent-orange animate-slide-in" style="animation-delay: 0.4s">
      <div class="flex items-start justify-between">
        <div>
          <p class="text-gray-600 text-sm font-medium mb-2" data-i18n="avgEfficiency">Avg Efficiency</p>
          <p class="stat-number text-orange-600" id="avgEfficiency">0</p>
          <p class="text-gray-500 text-sm mt-1" data-i18n="tonsPerWorkerPerDay">tons/worker/day</p>
        </div>
        <div class="p-3 bg-orange-100 rounded-xl">
          <i data-lucide="zap" style="width: 24px; height: 24px; color: #ea580c;"></i>
        </div>
      </div>
      <div class="mt-4 flex items-center gap-2" id="workingDaysContainer">
        <span class="text-xs text-gray-500"><span data-i18n="workingDays">Working days</span>: <span id="workingDays" class="font-semibold text-orange-600">0</span></span>
      </div>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Production Trend Chart -->
    <div class="glass-card p-6 animate-slide-in" style="animation-delay: 0.5s">
      <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
        <i data-lucide="line-chart" style="width: 20px; height: 20px;"></i>
        <span data-i18n="monthlyProductionTrend">Monthly Production Trend</span>
      </h3>
      <div class="chart-container">
        <canvas id="productionChart"></canvas>
      </div>
    </div>

    <!-- Worker Distribution Chart -->
    <div class="glass-card p-6 animate-slide-in" style="animation-delay: 0.6s">
      <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
        <i data-lucide="pie-chart" style="width: 20px; height: 20px;"></i>
        <span data-i18n="workerTypeDistribution">Worker Type Distribution</span>
      </h3>
      <div class="chart-container">
        <canvas id="workerChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Customer Performance Chart -->
  <div class="glass-card p-6 mb-6 animate-slide-in" style="animation-delay: 0.7s">
    <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
      <i data-lucide="bar-chart-2" style="width: 20px; height: 20px;"></i>
      <span data-i18n="customerPerformance">Customer Performance (Top 10)</span>
    </h3>
    <div style="height: 400px;">
      <canvas id="customerChart"></canvas>
    </div>
  </div>

  <!-- Top Performers Table -->
  <div class="glass-card p-6 animate-slide-in" style="animation-delay: 0.8s">
    <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
      <i data-lucide="trophy" style="width: 20px; height: 20px;"></i>
      <span data-i18n="topPerformingWorkers">Top 10 Performing Workers</span>
    </h3>
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead>
          <tr class="border-b-2 border-gray-200">
            <th class="text-left py-3 px-4 font-semibold text-gray-700" data-i18n="rank">Rank</th>
            <th class="text-left py-3 px-4 font-semibold text-gray-700" data-i18n="workerName">Worker Name</th>
            <th class="text-left py-3 px-4 font-semibold text-gray-700" data-i18n="type">Type</th>
            <th class="text-right py-3 px-4 font-semibold text-gray-700" data-i18n="totalTons">Total Tons</th>
            <th class="text-right py-3 px-4 font-semibold text-gray-700" data-i18n="daysWorked">Days Worked</th>
            <th class="text-right py-3 px-4 font-semibold text-gray-700" data-i18n="avgPerDay">Avg/Day</th>
            <th class="text-right py-3 px-4 font-semibold text-gray-700" data-i18n="revenueGenerated">Revenue Generated</th>
          </tr>
        </thead>
        <tbody id="topWorkersTable">
          <!-- Populated by JS -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // API URL
    const API_URL = 'api';

    // Global variables
    let productionChart, workerChart, customerChart;
    let dashboardData = {};

    // Update UI with translations using data-i18n attributes
    function applyTranslations() {
      console.log('[i18n] Applying translations for language:', currentLang);

      // Translate all elements with data-i18n attribute
      const elementsToTranslate = document.querySelectorAll('[data-i18n]');
      console.log('[i18n] Found', elementsToTranslate.length, 'elements to translate');

      elementsToTranslate.forEach(elem => {
        const key = elem.getAttribute('data-i18n');
        if (t[key]) {
          elem.textContent = t[key];
        } else {
          console.warn('[i18n] Translation key not found:', key);
        }
      });

      console.log('[i18n] Translations applied successfully');
    }

    // Apply all translations including charts
    function applyAllTranslations() {
      applyTranslations();
      // Re-render charts with new labels if data exists
      if (dashboardData.workers && dashboardData.workLogs) {
        renderCharts(dashboardData.workers, dashboardData.workLogs, dashboardData.customers);
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      // Apply translations
      applyTranslations();

      // Hide Back button if loaded inside iframe
      if (window.self !== window.top) {
        const backButton = document.getElementById('backButton');
        if (backButton) {
          backButton.style.display = 'none';
        }
      }

      initializeSelects();
      loadDashboardData();
      lucide.createIcons();
    });

    // Initialize month and year selects
    function initializeSelects() {
      const monthSelect = document.getElementById('monthSelect');
      const yearSelect = document.getElementById('yearSelect');

      const months = ['January', 'February', 'March', 'April', 'May', 'June',
                     'July', 'August', 'September', 'October', 'November', 'December'];

      const currentDate = new Date();
      // Default to previous month (more likely to have data)
      const defaultDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);
      const defaultMonth = defaultDate.getMonth() + 1;
      const defaultYear = defaultDate.getFullYear();

      // Populate months
      months.forEach((month, index) => {
        const option = document.createElement('option');
        option.value = index + 1;
        option.textContent = month;
        if (index + 1 === defaultMonth) option.selected = true;
        monthSelect.appendChild(option);
      });

      // Populate years (last 5 years)
      const currentYear = currentDate.getFullYear();
      for (let i = 0; i < 5; i++) {
        const year = currentYear - i;
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        if (year === defaultYear) option.selected = true;
        yearSelect.appendChild(option);
      }
    }

    // Load dashboard data
    async function loadDashboardData() {
      const month = document.getElementById('monthSelect').value;
      const year = document.getElementById('yearSelect').value;

      // Update current period display
      const monthName = document.getElementById('monthSelect').options[document.getElementById('monthSelect').selectedIndex].text;
      document.getElementById('currentPeriod').textContent = `${monthName} ${year}`;

      try {
        // Fetch all data in parallel
        const [workers, workLogs, customers] = await Promise.all([
          fetch(`${API_URL}/api_worker.php`).then(r => r.json()),
          fetch(`${API_URL}/api_get_worklogs.php`).then(r => r.json()),
          fetch(`${API_URL}/api_get_customer.php`).then(r => r.json())
        ]);

        // Filter work logs for selected month/year
        const filteredLogs = workLogs.filter(log => {
          const logDate = new Date(log.log_date);
          return logDate.getMonth() + 1 == month && logDate.getFullYear() == year;
        });

        // Store data globally for language switching
        dashboardData = {
          workers: workers,
          workLogs: filteredLogs,
          customers: customers
        };

        // Calculate metrics
        calculateMetrics(workers, filteredLogs, customers);

        // Render charts
        renderCharts(workers, filteredLogs, customers);

        // Render top workers table
        renderTopWorkersTable(workers, filteredLogs);

      } catch (error) {
        console.error('Error loading dashboard data:', error);
        alert('Failed to load dashboard data');
      }
    }

    // Calculate metrics
    function calculateMetrics(workers, workLogs, customers) {
      // Total production
      const totalProduction = workLogs.reduce((sum, log) => sum + parseFloat(log.tons || 0), 0);
      document.getElementById('totalProduction').textContent = totalProduction.toFixed(2);

      // Active workers
      const activeWorkers = workers.filter(w => w.status === 'Active').length;
      const localWorkers = workers.filter(w => w.status === 'Active' && w.type === 'Local').length;
      const foreignWorkers = workers.filter(w => w.status === 'Active' && w.type === 'Foreign').length;

      document.getElementById('activeWorkers').textContent = activeWorkers;
      document.getElementById('localWorkers').textContent = localWorkers;
      document.getElementById('foreignWorkers').textContent = foreignWorkers;

      // Total revenue
      const totalRevenue = workLogs.reduce((sum, log) => sum + (parseFloat(log.tons || 0) * parseFloat(log.rate_per_ton || 0)), 0);
      document.getElementById('totalRevenue').textContent = `RM ${totalRevenue.toFixed(2)}`;

      // Working days (unique dates)
      const uniqueDates = [...new Set(workLogs.map(log => log.log_date))];
      const workingDays = uniqueDates.length;
      document.getElementById('workingDays').textContent = workingDays;

      // Average efficiency
      const avgEfficiency = workingDays > 0 && activeWorkers > 0
        ? (totalProduction / (workingDays * activeWorkers)).toFixed(2)
        : 0;
      document.getElementById('avgEfficiency').textContent = avgEfficiency;
    }

    // Render charts
    function renderCharts(workers, workLogs, customers) {
      renderProductionChart(workLogs);
      renderWorkerChart(workers);
      renderCustomerChart(workLogs, customers);
    }

    // Production Trend Chart
    function renderProductionChart(workLogs) {
      const ctx = document.getElementById('productionChart').getContext('2d');

      // Handle empty data
      if (!workLogs || workLogs.length === 0) {
        if (productionChart) productionChart.destroy();
        productionChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: [t.noData],
            datasets: [{
              label: t.dailyProduction,
              data: [0],
              borderColor: '#10b981',
              backgroundColor: 'rgba(16, 185, 129, 0.1)',
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false }
            },
            scales: {
              y: { beginAtZero: true }
            }
          }
        });
        return;
      }

      // Group by date
      const dailyProduction = {};
      workLogs.forEach(log => {
        const date = log.log_date;
        if (!dailyProduction[date]) dailyProduction[date] = 0;
        dailyProduction[date] += parseFloat(log.tons || 0);
      });

      const sortedDates = Object.keys(dailyProduction).sort();
      const productions = sortedDates.map(date => dailyProduction[date]);

      if (productionChart) productionChart.destroy();

      productionChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: sortedDates.map(d => new Date(d).getDate()),
          datasets: [{
            label: t.dailyProduction,
            data: productions,
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            tension: 0.4,
            fill: true,
            pointRadius: 4,
            pointHoverRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    // Worker Distribution Chart
    function renderWorkerChart(workers) {
      const ctx = document.getElementById('workerChart').getContext('2d');

      const activeWorkers = workers.filter(w => w.status === 'Active');
      const local = activeWorkers.filter(w => w.type === 'Local').length;
      const foreign = activeWorkers.filter(w => w.type === 'Foreign').length;

      if (workerChart) workerChart.destroy();

      workerChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: [t.localWorkers, t.foreignWorkers],
          datasets: [{
            data: [local, foreign],
            backgroundColor: ['#10b981', '#f59e0b'],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }

    // Customer Performance Chart
    function renderCustomerChart(workLogs, customers) {
      const ctx = document.getElementById('customerChart').getContext('2d');

      // Handle empty data
      if (!workLogs || workLogs.length === 0) {
        if (customerChart) customerChart.destroy();
        customerChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: [t.noData],
            datasets: [{
              label: t.totalTons,
              data: [0],
              backgroundColor: '#8b5cf6',
              borderRadius: 8
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false }
            },
            scales: {
              y: { beginAtZero: true }
            }
          }
        });
        return;
      }

      // Calculate customer performance
      const customerPerformance = {};
      workLogs.forEach(log => {
        const customerId = log.customer_id;
        if (!customerPerformance[customerId]) {
          customerPerformance[customerId] = {
            name: log.customer_name,
            tons: 0,
            revenue: 0
          };
        }
        customerPerformance[customerId].tons += parseFloat(log.tons || 0);
        customerPerformance[customerId].revenue += parseFloat(log.tons || 0) * parseFloat(log.rate_per_ton || 0);
      });

      // Get top 10
      const sorted = Object.values(customerPerformance)
        .sort((a, b) => b.tons - a.tons)
        .slice(0, 10);

      if (customerChart) customerChart.destroy();

      customerChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: sorted.map(c => c.name),
          datasets: [{
            label: 'Total Tons',
            data: sorted.map(c => c.tons),
            backgroundColor: '#8b5cf6',
            borderRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    // Render top workers table
    function renderTopWorkersTable(workers, workLogs) {
      const tbody = document.getElementById('topWorkersTable');

      // Handle empty data
      if (!workLogs || workLogs.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="7" class="py-8 px-4 text-center text-gray-500">
              No work log data available for the selected period
            </td>
          </tr>
        `;
        return;
      }

      // Calculate worker performance
      const workerPerformance = {};
      workLogs.forEach(log => {
        const workerId = log.worker_id;
        if (!workerPerformance[workerId]) {
          const worker = workers.find(w => w.id == workerId);
          workerPerformance[workerId] = {
            name: log.worker_name,
            type: worker ? worker.type : 'Unknown',
            tons: 0,
            days: new Set(),
            revenue: 0
          };
        }
        workerPerformance[workerId].tons += parseFloat(log.tons || 0);
        workerPerformance[workerId].days.add(log.log_date);
        workerPerformance[workerId].revenue += parseFloat(log.tons || 0) * parseFloat(log.rate_per_ton || 0);
      });

      // Convert to array and sort
      const sorted = Object.entries(workerPerformance)
        .map(([id, data]) => ({
          ...data,
          daysWorked: data.days.size,
          avgPerDay: data.tons / data.days.size
        }))
        .sort((a, b) => b.tons - a.tons)
        .slice(0, 10);

      // Render table
      tbody.innerHTML = sorted.map((worker, index) => {
        // Translate worker type
        const workerTypeText = worker.type === 'Local' ? t.local : t.foreign;

        return `
        <tr class="border-b border-gray-100 hover:bg-gray-50 transition">
          <td class="py-3 px-4">
            <div class="flex items-center gap-2">
              ${index < 3 ? `<i data-lucide="trophy" style="width: 16px; height: 16px; color: ${['#FFD700', '#C0C0C0', '#CD7F32'][index]};"></i>` : ''}
              <span class="font-semibold">#${index + 1}</span>
            </div>
          </td>
          <td class="py-3 px-4 font-medium">${worker.name}</td>
          <td class="py-3 px-4">
            <span class="px-2 py-1 rounded-full text-xs font-semibold ${worker.type === 'Local' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}">
              ${workerTypeText}
            </span>
          </td>
          <td class="py-3 px-4 text-right font-semibold text-emerald-600">${worker.tons.toFixed(2)}</td>
          <td class="py-3 px-4 text-right">${worker.daysWorked}</td>
          <td class="py-3 px-4 text-right">${worker.avgPerDay.toFixed(2)}</td>
          <td class="py-3 px-4 text-right font-semibold">RM ${worker.revenue.toFixed(2)}</td>
        </tr>
      `;
      }).join('');

      lucide.createIcons();
    }

    // Export to Excel (placeholder)
    function exportToExcel() {
      alert('Excel export feature will be implemented with a library like SheetJS');
    }
  </script>
</body>
</html>
